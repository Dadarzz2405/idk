{% extends "base.html" %}

{% block title %}Division Management — Rohis{% endblock %}

{% block content %}
<div class="mt-4">
    <h2>Assign Attendance Permission</h2>

    <form method="POST">
        <div class="mb-3">
            <label class="form-label">Select Division</label>
            <select name="division_id" class="form-select" required>
                {% for d in divisions %}
                    <option value="{{ d.id }}">{{ d.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Select Members (hold Ctrl / Cmd to select multiple)</label>
            <select name="user_ids" class="form-select" multiple size="8" required>
                {% for user in users %}
                    <option value="{{ user.id }}">{{ user.name }} — {{ user.division.name if user.division else 'No Division' }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="mb-3">
            <label class="form-label">Choose one member to be able to mark attendance (optional)</label>
            <select name="marker_id" class="form-select">
                <option value="">-- No marker --</option>
                {% for user in users %}
                    <option value="{{ user.id }}">{{ user.name }}</option>
                {% endfor %}
            </select>
        </div>

        <button class="btn btn-primary" type="submit">Save</button>
    </form>

    <hr>

    <h4>Current Permissions</h4>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Name</th>
                <th>Role</th>
                <th>Division</th>
                <th>Permission</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td>{{ u.name }}</td>
                <td>{{ u.role }}</td>
                <td>{{ u.division.name if u.division else '-' }}</td>
                <td>{{ '✅' if u.can_mark_attendance else '❌' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
